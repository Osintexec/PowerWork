---
- hosts: all
  become: yes

  tasks:
  ########################################################################################
  - name: MAIN BLOCK
    block:
  
  ########################################################################################
    - name: BASE CONFIG
      block:
      - include_role:
          name: powerwork
          
      - include_role:
          name: powerwork_default_packages

    ######################################################################################
    - name: INSTALL PACKAGES, MODULES, AND ROLES
      block:
      - name: Install apt packages
        apt:
          update_cache: yes
          name:
          - netcat
          - ettercap-graphical
          - masscan
      
      - include_role:
          name: "{{ item }}"
        loop:
        - beef
        - burpsuite
        - checksec
        - chrome
        - metasploit
        - nikto
        - nmap
        - zap
        - wireshark

      - name: Create menu entries
        copy:
          dest: "{{ appmenu_path }}/{{ item.file }}.desktop"
          mode: 0644
          content: |
            [Desktop Entry]
            Name={{ item.name }}
            GenericName={{ item.generic_name }}
            Comment={{ item.comment }}
            Exec=mate-terminal --command "expect /opt/bin/cmd.sh '{{ item.exec }}'"
            Terminal=false
            Type=Application
            Categories=Slingshot
        loop:
          - { file: 'beef', name: 'BeEF', generic_name: 'Exploitation Tool', comment: 'Browser Exploitation Framework', exec: 'beef -h' }
          - { file: 'bettercap', name: 'bettercap', generic_name: 'Sniffer', comment: 'Swiss Army knife for network reconnaissance and MITM attacks', exec: 'bettercap -h' }
          - { file: 'burp', name: 'Burp Suite', generic_name: 'Web App Tool', comment: 'Platform for security testing of web applications', exec: 'burp' }
          - { file: 'nikto', name: 'Nikto', generic_name: 'Information Gathering', comment: 'Scan web servers for vulnerabilities', exec: 'nikto -h' }
          - { file: 'nmap', name: 'Nmap', generic_name: 'Scanner', comment: 'Flexible network scanner', exec: 'nmap -h' }
          - { file: 'zap', name: 'ZAP', generic_name: 'Web App Tool', comment: 'OWASP Zed Attack Proxy', exec: 'zap' }
        when: create_appmenu is defined and create_appmenu

    ######################################################################################
    - name: INSTALL DESKTOP
      block:
      - include_role:
          name: mate

